<!DOCTYPE html><html lang="es"><head><title> Configuraci&oacute;n de registro BrewPiless </title><script>var JSVERSION = "3.1";

function s_ajax(b) {
    var c = new XMLHttpRequest();
    c.onreadystatechange = function() {
        if (c.readyState == 4) {
            if (c.status == 200) {
                b.success(c.responseText)
            } else {
                c.onerror(c.status)
            }
        }
    };
    c.ontimeout = function() {
        if (typeof b["timeout"] != "undefined") b.timeout();
        else c.onerror(-1)
    }, c.onerror = function(a) {
        if (typeof b["fail"] != "undefined") b.fail(a)
    };
    c.open(b.m, b.url, true);
    if (typeof b["data"] != "undefined") {
        c.setRequestHeader("Content-Type", (typeof b["mime"] != "undefined") ? b["mime"] : "application/x-www-form-urlencoded");
        c.send(b.data)
    } else c.send()
}

var Q = function(d) {
    return document.querySelector(d);
};

function C2F(c) {
    return Math.round((c * 1.8 + 32) * 10) / 10
}

function F2C(f) {
    return Math.round((f - 32) / 1.8 * 10) / 10
}

function openDlgLoading() {
    document.getElementById('dlg_loading').style.display = "block";
}

function closeDlgLoading() {
    document.getElementById('dlg_loading').style.display = "none";
}

var BrewMath = {
    abv: function(og, fg) {
        return ((76.08 * (og - fg) / (1.775 - og)) * (fg / 0.794)).toFixed(1);
    },
    abvP: function(og, fg) {
        return BrewMath.abv(BrewMath.pla2sg(og), BrewMath.pla2sg(fg));
    },
    att: function(og, fg) {
        return Math.round((og - fg) / (og - 1) * 100);
    },
    attP: function(pog, pfg) {
        return Math.round((pog - pfg) / pog * 100);
    },
    sg2pla: function(sg) {
        return (((182.4601 * sg - 775.6821) * sg + 1262.7794) * sg - 669.5622);
    },
    pla2sg: function(pla) {
        return 1 + (pla / (258.6 - ((pla / 258.2) * 227.1)));
    },
    tempCorrectionF(sg, t, c) {
        var nsg = sg * ((1.00130346 - 0.000134722124 * t + 0.00000204052596 * t * t - 0.00000000232820948 * t * t * t) /
            (1.00130346 - 0.000134722124 * c + 0.00000204052596 * c * c - 0.00000000232820948 * c * c * c));
        return nsg;
    },
    pTempCorrectionF(sg, t, c) {
        return BrewMath.sg2pla(BrewMath.tempCorrectionF(BrewMath.pla2sg(sg), t, c));
    },
    tempCorrection(celsius, sg, t, c) {
        return celsius ? BrewMath.tempCorrectionF(sg, C2F(t), C2F(c)) : BrewMath.tempCorrectionF(sg, t, c);
    },
    pTempCorrection(celsius, sg, t, c) {
        return celsius ? BrewMath.pTempCorrectionF(sg, C2F(t), C2F(c)) : BrewMath.tempCorrectionF(sg, t, c);
    }
};

Date.prototype.shortLocalizedString = function() {
    var y = this.getYear() + 1900;
    var re = new RegExp('[^\d]?' + y + '[^\d]?');
    var n = this.toLocaleDateString();
    var ds = n.replace(re, "");
    var HH = this.getHours();
    var MM = this.getMinutes();

    function T(x) {
        return (x > 9) ? x : ("0" + x);
    }
    return ds + " " + T(HH) + ":" + T(MM);
};

function getActiveNavItem() {
    var path = window.location.pathname.split("/").pop();
    if (path == "") path = "index.htm";
    var element = Q('.options>li>a[href="/' + path + '"]');
    element.className += 'active';
}

function formatDate(dt) {
    //	var y = dt.getFullYear();
    //	var M = dt.getMonth() +1;
    //	var d = dt.getDate();
    var h = dt.getHours();
    var m = dt.getMinutes();
    //    var s = dt.getSeconds();
    function dd(n) {
        return (n < 10) ? '0' + n : n;
    }
    //	return dd(M) + "/" + dd(d) + "/" + y +" "+ dd(h) +":"+dd(m)+":"+dd(s);
    //	return dd(M) + "/" + dd(d) +" "+ dd(h) +":"+dd(m);
    return dt.toLocaleDateString() + " " + dd(h) + ":" + dd(m);
}

function formatDateForPicker(date) {
    var h = date.getHours();
    var m = date.getMinutes();

    function dd(n) { return (n < 10) ? '0' + n : n; }
    return date.getFullYear() + "-" + dd(date.getMonth() + 1) + "-" + dd(date.getDate()) + "T" + dd(h) + ":" + dd(m);
}</script><script>var logurl="log";Number.prototype.format=function(t,e,r,o){var l="\\d(?=(\\d{"+(e||3)+"})+"+(t>0?"\\D":"$")+")",n=this.toFixed(Math.max(0,~~t));return(o?n.replace(".",o):n).replace(new RegExp(l,"g"),"$&"+(r||","))},String.prototype.escapeJSON=function(){return this.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\/]/g,"\\/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t")};var logs={url:"loglist.php",rmurl:"loglist.php?rm=",starturl:"loglist.php?start=",stopurl:"loglist.php?stop=1",dlurl:"loglist.php?dl=",ll:[],fs:{},logging:!1,vname:function(t){return""!=t&&!t.match(/[\W]/g)},dupname:function(t){var e=!1;return this.ll.forEach(function(r){t==r.name&&(e=!0)}),e},fsinfo:function(t,e){Q("#fssize").innerHTML=t.format(0,3,","),Q("#fsused").innerHTML=e.format(0,3,","),Q("#fsfree").innerHTML=(t-e).format(0,3,",")},stoplog:function(){if(this.logging&&confirm("Detener el registro en curso?")){var t=Q("#logname").value.trim();s_ajax({url:this.stopurl+t,m:"GET",success:function(t){location.reload()},fail:function(t){alert("Fallo al parar por:"+t)}})}},startlog:function(){var t=this;if(!t.logging){if(t.ll.length>=10)return void alert("Demaciados registros. Borre alguno antes de crear uno nuevo.");if(t.fs.size-t.fs.used<=2*t.fs.block)return void alert("No hay suficiente memoria libre!");var e=Q("#logname").value.trim();if(!1===t.vname(e))return void alert("Nombre de archivo inv&aacute;lido, no utilice caracteres especiales ni espacios.");if(t.dupname(e))return void alert("Nombre duplicado.");var r="";if(Q("#calispindel").checked){var o=parseFloat(Q("#tiltinw").value.trim()),l=parseFloat(Q("#hydrometer").value.trim());if(window.plato&&(l=0),isNaN(o))alert("Es necesario el valor de la inclinaci&oacute;n!");else if(!window.plato&&(isNaN(o)||isNaN(l)))return void alert("Es necesario el valor de la inclinaci&oacute;n y la lectura del densimetro manual!");r="&tw="+o+"&hr="+l}confirm("Comenzar un nuevo registro?")&&s_ajax({url:t.starturl+e+r,m:"GET",success:function(t){location.reload()},fail:function(t){alert("Fallo al iniciar por:"+t)}})}},recording:function(t,e){this.logging=!0;var r=new Date(1e3*e);Q("#start-log-date").innerHTML=r.toLocaleString(),Q("#loggingtitle").innerHTML=t,Q("#logstartinput").style.display="none",Q("#logstopinput").style.display="block"},stop:function(){this.logging=!1,Q("#logstartinput").style.display="block",Q("#logstopinput").style.display="none"},rm:function(t){var e=this;confirm("Borrar el log "+e.ll[t].name)&&(console.log("rm "+e.ll[t].name),s_ajax({url:e.rmurl+t,m:"GET",success:function(r){var o=JSON.parse(r);e.fs=o,e.fsinfo(o.size,o.used),e.ll.splice(t,1),e.list(e.ll)},fail:function(t){alert("Fallo al borrar por:"+t)}}))},dl:function(t){window.open(this.dlurl+t)},list:function(t){for(var e,r=Q("#loglist").querySelector("tbody");e=r.querySelector("tr:nth-of-type(2)");)r.removeChild(e);var o=this,l=o.row;t.forEach(function(t,e){var n=t.name,i=new Date(1e3*t.time),a=l.cloneNode(!0);a.querySelector(".logid").innerHTML=n,a.querySelector(".logdate").innerHTML=i.toLocaleString(),a.querySelector(".dlbutton").onclick=function(){o.dl(e)},a.querySelector(".rmbutton").onclick=function(){o.rm(e)},r.appendChild(a)})},init:function(){var t=this;Q("#startlogbutton").onclick=function(){t.startlog()},Q("#stoplogbutton").onclick=function(){t.stoplog()},t.row=Q("#loglist").querySelector("tr:nth-of-type(2)"),t.row.parentNode.removeChild(t.row),s_ajax({url:t.url,m:"GET",success:function(e){var r=JSON.parse(e);if(t.fs=r.fs,r.rec&&t.recording(r.log,r.start),t.ll=r.list,t.list(r.list),t.fsinfo(r.fs.size,r.fs.used),void 0!==r.plato&&r.plato){window.plato=!0;for(var o=document.querySelectorAll(".tiltwatercorrect"),l=0;l<o.length;l++)o[l].style.display="none"}else window.plato=!1},fail:function(t){alert("fall&oacute;:"+t)}})}};function checkurl(t){t.value.trim().startsWith("https")&&alert("HTTPS no esta soportado")}function checkformat(e){e.value.length>256&&(e.value=t.value.substring(0,256)),Q("#fmthint").innerHTML=e.value.length+"/256"}function cmethod(t){for(var e=document.querySelectorAll('input[name$="method"]'),r=0;r<e.length;r++)e[r].id!=t.id&&(e[r].checked=!1);window.selectedMethod=t.value}function update(){if(void 0!==window.selectedMethod){var t=Q("#format").value.trim();if("GET"==window.selectedMethod)if(new RegExp("s","g").exec(t))return void alert("espacio no est&aacute; permitido");var e={};e.enabled=Q("#enabled").checked,e.url=Q("#url").value.trim(),e.format=encodeURIComponent(t.escapeJSON()),e.period=Q("#period").value,e.method=Q("#m_post").checked?"POST":"GET",e.type=Q("#data-type").value.trim(),s_ajax({url:logurl,m:"POST",data:"data="+JSON.stringify(e),success:function(t){alert("Listo")},fail:function(t){alert("fall&oacute;:"+t)}})}else alert("Seleccione m&eacute;todo!")}function init(t){function e(){var t=parseFloat(Q("#watertemp").value),e=parseFloat(Q("#caltemp").value),r=Q("#tempunit").value;if(!isNaN(t)&&!isNaN(e)){"C"==r&&(e=C2F(e),t=C2F(t));var o=BrewMath.tempCorrectionF(1,e,t);Q("#hydrometer").value=o.toFixed(3)}}void 0===t&&(t=!1),t||(getActiveNavItem(),Q("#verinfo").innerHTML="v"+JSVERSION),Q("#watertemp").onchange=e,Q("#caltemp").onchange=e,Q("#tempunit").onchange=e,s_ajax({url:logurl+"?data=1",m:"GET",success:function(t){var e=JSON.parse(t);void 0!==e.enabled&&(Q("#enabled").checked=e.enabled,window.selectedMethod=e.method,Q("#m_"+e.method.toLowerCase()).checked=!0,Q("#url").value=void 0===e.url?"":e.url,Q("#data-type").value=void 0===e.type?"":e.type,Q("#format").value=void 0===e.format?"":e.format,checkformat(Q("#format")),Q("#period").value=void 0===e.period?300:e.period)}}),logs.init()}function showformat(t){var e=Q("#formatlist"),r=t.getBoundingClientRect();e.style.display="block",e.style.left=r.right+5+"px",e.style.top=r.bottom+5+"px"}function hideformat(){Q("#formatlist").style.display="none"}</script><style>#loglist,#loglist td,#loglist th,#loglist tr{border:1px solid #000}fieldset{margin:10px}#fsinfo{margin:10px}#formatlist{display:none;position:absolute;border:1px solid #fff;background:#d3d3d3}#formatlist table,#formatlist td,#formatlist th{border:1px solid #000;border-collapse:collapse}</style></head><body onload=init(!0)><fieldset><legend> Registro remoto </legend><form><table><tr><th> Habilitado: </th><td><input type=checkbox id=enabled value=yes></td></tr><tr><th> M&eacute;todo: </th><td><input type=checkbox id=m_get name=method value=GET onchange=cmethod(this)>Get <input type=checkbox id=m_post name=method value=POST onchange=cmethod(this)>Post <input type=checkbox id=m_put name=method value=PUT onchange=cmethod(this)>Put</td></tr><tr><th> URL: </th><td><input type=text id=url size=128 placeholder="input link" onchange=checkurl(this)></td></tr><tr><th></th><td>JSON:"application/json", Form Type:"application/x-www-form-urlencoded"</td></tr><tr><th>DataType:</th><td><input type=text id=data-type size=42 placeholder=Content-Type></td></tr><tr><th></th><td><span onmouseover=showformat(this) onmouseout=hideformat()><u>Notaci&oacute;n de valores</u></span></td></tr><tr><th> Formato: </th><td><textarea id=format rows=4 cols=64 oninput=checkformat(this)></textarea></td></tr><tr><th></th><td> Caracteres:<span id=fmthint></span></td></tr><tr><th> Registar durante: </th><td><input type=text id=period size=4> segundos </td></tr><tr><th></th><td><button type=button onclick=update()>Actualizar</button></td></tr></table></form></fieldset><fieldset><legend> Registro local </legend><div id=logctrl style=border-style:outset;padding:16px><div id=logstartinput><span id=logtitle>Nombre del nuevo registro:</span><input type=text id=logname size=24 maxlength=24> <button id=startlogbutton>Comenzar a registrar</button><div style=margin-left:16px><strong> Opciones:</strong><br> Calibrar iSpindel <input type=checkbox id=calispindel><br> Inclinaci&oacute;n en agua pura <input type=text id=tiltinw size=6> <span class=tiltwatercorrect> Densidad medida: <input type=text id=hydrometer size=6> , o agua @ <input type=text id=watertemp size=4>&deg; calibrado <input type=text id=caltemp size=4>&deg;<select id=tempunit><option vlue=C>C</option><option value=F>F</option></select></span></div></div><div id=logstopinput style=display:none><strong id=loggingtitle></strong> desde <strong id=start-log-date></strong> <button id=stoplogbutton>Detener el registro</button></div></div><div id=fsinfo> Memoria libre: <span id=fsfree>0</span> Bytes, Memoria usada: <span id=fsused>0</span> Bytes, Memoria Total: <span id=fssize>0</span> Bytes</div><table id=loglist><tr><th style=width:30%> Nombre </th><th style=width:40%> Fecha </th><th> Acci&oacute;nes </th></tr><tr><td class=logid></td><td class=logdate></td><td><button class=dlbutton>Descargar</button><button class=rmbutton>Eliminar</button></td></tr></table></fieldset><div id=formatlist><table><tr><th>%b</th><td> Temp. Cerveza </td></tr><tr><th>%B</th><td> Seteo Cerveza </td></tr><tr><th>%f</th><td> Temp. Nevera </td></tr><tr><th>%F</th><td> Seteo  Nevera </td></tr><tr><th>%r</th><td> Temp. habitaci&oacute;n </td></tr><tr><th>%g</th><td> Densidad </td></tr><tr><th>%a</th><td> Temp. iSpindel </td></tr><tr><th>%v</th><td> Voltage iSpindel </td></tr><tr><th>%t</th><td> Inclinaci&oacute;n </td></tr><tr><th>%u</th><td> Unix timestamp de la &uacute;ltima medici&oacute;n de densidad </td></tr></table></div></body></html>