<html><head><meta http-equiv=content-type content="text/html; charset=utf-8"><meta name=viewport content="width=device-width,initial-scale=1"><title>BrewPiLess reporting for duty!</title><meta name=apple-mobile-web-app-title content=BrewPiLess><meta name=apple-mobile-web-app-capable content=yes><script src=http://cdnjs.cloudflare.com/ajax/libs/dygraph/1.1.1/dygraph-combined.js></script><script>function invoke(n){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(200==e.status?n.success(e.responseText):e.onerror(e.status))},e.ontimeout=function(){void 0!==n.timeout?n.timeout():e.onerror(-1)},e.onerror=function(e){void 0!==n.fail&&n.fail(e)},e.open(n.m,n.url,!0),void 0!==n.data?(e.setRequestHeader("Content-Type",void 0!==n.mime?n.mime:"application/x-www-form-urlencoded"),e.send(n.data)):e.send()}var BWF={BrewProfile:"/brewing.json",sse:!0,process:function(msg){if(null==this.raw){eval("m={"+msg+"}");for(var key in m)void 0!==this.handlers[key]&&this.handlers[key](m[key])}else this.raw(msg)},on:function(n,e){this.handlers[n]=e},send:function(n,e){e=void 0===e?{}:e;var o=this;invoke({m:"POST",url:"/putline",mime:"application/x-www-form-urlencoded",data:"data="+encodeURI(n),success:function(){void 0!==e.success&&e.success()},fail:function(n){void 0!==e.fail?e.fail(n):o.error(n)}})},connect:function(){var n=this,e=new EventSource("/getline");e.onmessage=function(e){n.process(e.data)},e.onerror=function(){n.error(-2),e.close(),setTimeout(function(){n.connect()},5e3)},e.onopen=function(){n.onconnect()},this.es=e},reconnect:function(){this.sse&&(this.es.close(),this.connect())},init:function(n){var e=this;if(e.error=void 0===n.error?function(){}:n.error,e.handlers=void 0===n.handlers?{}:n.handlers,e.raw=void 0===n.raw?null:n.raw,e.onconnect=void 0===n.onconnect?function(){}:n.onconnect,"undefined"!=typeof EventSource)e.connect();else{console.log("not support SSE"),e.sse=!1;var o=void 0===n.polling?5e3:n.polling;setInterval(function(){invoke({m:"GET",url:"/getline_p",success:function(n){e.process(n)},fail:function(n){e.error(n)}})},o)}},save:function(n,e,o,t){invoke({m:"POST",url:"/fputs",data:"path="+n+"&content="+encodeURIComponent(e),success:function(){o()},fail:function(n){t(n)}})},load:function(n,e,o){invoke({m:"GET",url:n,success:function(n){e(n)},fail:function(n){o(n)}})}}</script><script>function s_ajax(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4==t.readyState&&(200==t.status?e.success(t.responseText):t.onerror(t.status))},t.ontimeout=function(){void 0!==e.timeout?e.timeout():t.onerror(-1)},t.onerror=function(t){void 0!==e.fail&&e.fail(t)},t.open(e.m,e.url,!0),void 0!==e.data?(t.setRequestHeader("Content-Type",void 0!==e.mime?e.mime:"application/x-www-form-urlencoded"),t.send(e.data)):t.send()}function fgstate(e){var t={0:"red",12:"orange",24:"yellow",48:"green"};Q("#fgstate").style.backgroundColor=t[e]}function checkfgstate(){fgstate(GravityTracker.stable(12)?GravityTracker.stable(24)?GravityTracker.stable(48)?48:24:12:0)}function formatDate(e){function t(e){return e<10?"0"+e:e}var i=e.getHours(),r=e.getMinutes();return e.toLocaleDateString()+" "+t(i)+":"+t(r)}function saveprofile(){var e=profileEditor.getProfile();if(!1!==e){var t=JSON.stringify(e);console.log("result="+t),BWF.save(BWF.BrewProfile,encodeURIComponent(t),function(){profileEditor.markdirty(!1),alert("Done.")},function(e){alert("save failed:"+e)})}else alert("invalid value. check again")}function C2F(e){return Math.round(10*(1.8*e+32))/10}function F2C(e){return Math.round((e-32)/1.8*10)/10}function updateTempUnit(e){for(var t=document.getElementsByClassName("t_unit"),i=0;i<t.length;i++)t[i].innerHTML=e}function openDlgLoading(){document.getElementById("dlg_loading").style.display="block"}function closeDlgLoading(){document.getElementById("dlg_loading").style.display="none"}function onload(e){function t(){function t(){i&&(i=!1,closeDlgLoading(),e())}var i=!0;invoke({url:"/tcc",m:"GET",fail:function(e){console.log("error connect to BrwePiLess!"),t()},success:function(e){var i=JSON.parse(e),r={valid:!0,minDegree:i.tempSetMin,maxDegree:i.tempSetMax,tempUnit:i.tempFormat};r.tempUnit!=BrewPiSetting.tempUnit&&(updateTempUnit(r.tempUnit),profileEditor.setTempUnit(r.tempUnit)),BrewPiSetting=r,t()}})}modekeeper.init(),openDlgLoading(),BWF.load(BWF.BrewProfile,function(e){try{var i=JSON.parse(e);updateTempUnit(i.u),BrewPiSetting.tempUnit=i.u,profileEditor.initProfile(i),ControlChart.init("tc_chart",profileEditor.chartdata(),i.u)}catch(e){console.log("error:"+e),profileEditor.initProfile(),ControlChart.init("tc_chart",profileEditor.chartdata(),profileEditor.tempUnit)}t()},function(e){profileEditor.initProfile(),ControlChart.init("tc_chart",profileEditor.chartdata(),profileEditor.tempUnit),t()})}function getLogName(){s_ajax({url:"loglist.php",m:"GET",success:function(e){var t=JSON.parse(e);t.rec?Q("#recording").innerHTML=t.log:Q("#recording").innerHTML=""},fail:function(e){alert("failed:"+e)}})}function setLcdText(e,t){document.getElementById(e).innerHTML=t}function communicationError(){setLcdText("lcd-line-0","Failed to"),setLcdText("lcd-line-1","connect to"),setLcdText("lcd-line-2","Server"),setLcdText("lcd-line-3","")}function controllerError(){setLcdText("lcd-line-0","Controller not"),setLcdText("lcd-line-1","updating data"),setLcdText("lcd-line-2","..."),setLcdText("lcd-line-3","")}function gravityDevice(e){if(void 0!==e.name){if(e.name.startsWith("iSpindel")){void 0===window.iSpindel&&(window.iSpindel=!0,Q("#iSpindel-pane").style.display="block"),Q("#iSpindel-name").innerHTML=e.name,void 0!==e.battery&&(Q("#iSpindel-battery").innerHTML=e.battery);var t;t=void 0!==e.lu?new Date(1e3*e.lu):new Date,Q("#iSpindel-last").innerHTML=formatDate(t),void 0!==e.sg&&updateGravity(e.sg),void 0!==e.angle&&console.log("iSpindel:"+JSON.stringify(e))}void 0!==e.lpf&&GravityFilter.setBeta(e.lpf),void 0!==e.stpt&&GravityTracker.setThreshold(e.stpt)}}function init(){BChart.init("div_g");var e=!0;onload(function(){BWF.init({onconnect:function(){BWF.send("l"),setInterval(function(){e||controllerError(),BWF.send("l"),e=!1},5e3)},error:function(e){communicationError()},handlers:{L:function(t){e=!0;for(var i=0;i<4;i++)setLcdText("lcd-line-"+i,t[i])},V:function(e){console.log("forced reload chart"),BChart.reqnow()},G:function(e){gravityDevice(e)}}}),BChart.start()})}function updateGravity(e){window.sg=e,Q("#gravity-sg").innerHTML=e.toFixed(3),void 0!==window.og&&(Q("#gravity-att").innerHTML=BrewMath.att(window.og,e),Q("#gravity-abv").innerHTML=BrewMath.abv(window.og,e))}function updateOriginGravity(e){void 0!==window.og&&window.og==e||(window.og=e,Q("#gravity-og").innerHTML=e.toFixed(3),void 0!==window.sg&&updateGravity(window.sg))}function showgravitydlg(e){Q("#dlg_addgravity .msg").innerHTML=e,Q("#dlg_addgravity").style.display="block"}function dismissgravity(){Q("#dlg_addgravity").style.display="none"}function inputgravity(){var e=parseFloat(Q("#dlg_addgravity input").value);if(!(e<.8||e>1.25)){dismissgravity(),openDlgLoading(),window.isog?updateOriginGravity(e):updateGravity(e);var t={name:"webjs",gravity:e};window.isog&&(t.og=1),s_ajax({url:"gravity",m:"POST",mime:"application/json",data:JSON.stringify(t),success:function(e){closeDlgLoading()},fail:function(e){alert("failed:"+e),closeDlgLoading()}})}}function inputSG(){window.isog=!1,showgravitydlg("Add gravity Record:")}function inputOG(){window.isog=!0,showgravitydlg("Set Original Gravity:")}var Q=function(e){return document.querySelector(e)},GravityFilter={b:.1,y:0,add:function(e){return 0==this.y?this.y=e:this.y=this.y+this.b*(e-this.y),Math.round(1e4*this.y)/1e4},setBeta:function(e){this.b=e}},GravityTracker={NumberOfSlots:48,InvalidValue:255,ridx:0,record:[],threshold:1,setThreshold:function(e){this.threshold=e},addRecord:function(e){this.record[this.ridx++]=e,this.ridx>=this.NumberOfSlots&&(this.ridx=0)},stable:function(e,t){t=void 0===t?this.threshold:t;var i=this.ridx-1;i<0&&(i=this.NumberOfSlots-1);for(var r=this.NumberOfSlots+this.ridx-e;r>=this.NumberOfSlots;)r-=this.NumberOfSlots;return this.record[r]-this.record[i]<=t},Period:3600,init:function(){this.curerntStart=0,this.lastValue=0},add:function(e,t){gravity=Math.round(1e3*e,1);var i=t-this.curerntStart;if(i>this.Period){if(this.addRecord(gravity),0!=this.lastValue)for(i-=this.Period;i>this.Period;)i-=this.Period,this.addRecord(this.lastValue);this.curerntStart=t,this.lastValue=gravity}}},BrewChart=function(e){this.cid=e,this.ctime=0,this.interval=60,this.numLine=7,this.lidx=0,this.celius=!0,this.clearData()};BrewChart.prototype.clearData=function(){this.laststat=[NaN,NaN,NaN,NaN,NaN,NaN,NaN,NaN],this.sg=NaN,this.og=NaN},BrewChart.prototype.setCelius=function(e){this.celius=e,this.ylabel(STR.ChartLabel+"("+(e?"째C":"째F")+")")},BrewChart.prototype.incTime=function(){this.ctime+=this.interval},BrewChart.prototype.formatDate=function(e){function t(e){return e>9?e:"0"+e}var i=e.getHours(),r=e.getMinutes(),n=e.getSeconds();return e.toLocaleDateString()+" "+t(i)+":"+t(r)+":"+t(n)},BrewChart.prototype.showLegend=function(e,t){var i=new Date(e);Q(".beer-chart-legend-time").innerHTML=this.formatDate(i),Q(".chart-legend-row.beerTemp .legend-value").innerHTML=this.tempFormat(this.chart.getValue(t,2)),Q(".chart-legend-row.beerSet .legend-value").innerHTML=this.tempFormat(this.chart.getValue(t,1)),Q(".chart-legend-row.fridgeTemp .legend-value").innerHTML=this.tempFormat(this.chart.getValue(t,3)),Q(".chart-legend-row.fridgeSet .legend-value").innerHTML=this.tempFormat(this.chart.getValue(t,4)),Q(".chart-legend-row.roomTemp .legend-value").innerHTML=this.tempFormat(this.chart.getValue(t,5)),Q(".chart-legend-row.auxTemp .legend-value").innerHTML=this.tempFormat(this.chart.getValue(t,6));var r=this.chart.getValue(t,7);Q(".chart-legend-row.gravity .legend-value").innerHTML=!r||isNaN(r)?"--":r.toFixed(4);var n=this.chart.getValue(t,8);Q(".chart-legend-row.filtersg .legend-value").innerHTML=!n||isNaN(n)?"--":n.toFixed(4);var a=parseInt(this.state[t]);isNaN(a)||(Q(".chart-legend-row.state .legend-label").innerHTML=STATES[a].text)},BrewChart.prototype.hideLegend=function(){document.querySelectorAll(".legend-value").forEach(function(e){e.innerHTML="--"}),Q(".beer-chart-legend-time").innerHTML=this.dateLabel,Q(".chart-legend-row.state .legend-label").innerHTML="state"},BrewChart.prototype.tempFormat=function(e){var t=parseFloat(e);if(isNaN(t))return"--";var i=this.celius?"째C":"째F";return parseFloat(t).toFixed(2)+i},BrewChart.prototype.initLegend=function(){Q(".chart-legend-row.beerTemp").style.color=BrewChart.Colors[1],Q(".beerTemp .toggle").style.backgroundColor=BrewChart.Colors[1],Q(".chart-legend-row.beerSet").style.color=BrewChart.Colors[0],Q(".beerSet .toggle").style.backgroundColor=BrewChart.Colors[0],Q(".chart-legend-row.fridgeTemp").style.color=BrewChart.Colors[2],Q(".fridgeTemp .toggle").style.backgroundColor=BrewChart.Colors[2],Q(".chart-legend-row.fridgeSet").style.color=BrewChart.Colors[3],Q(".fridgeSet .toggle").style.backgroundColor=BrewChart.Colors[3],Q(".chart-legend-row.roomTemp").style.color=BrewChart.Colors[4],Q(".roomTemp .toggle").style.backgroundColor=BrewChart.Colors[4],Q(".chart-legend-row.gravity").style.color=BrewChart.Colors[6],Q(".gravity .toggle").style.backgroundColor=BrewChart.Colors[6],Q(".chart-legend-row.auxTemp").style.color=BrewChart.Colors[5],Q(".auxTemp .toggle").style.backgroundColor=BrewChart.Colors[5],Q(".chart-legend-row.filtersg").style.color=BrewChart.Colors[7],Q(".filtersg .toggle").style.backgroundColor=BrewChart.Colors[7],this.dateLabel=Q(".beer-chart-legend-time").innerHTML},BrewChart.prototype.toggleLine=function(e){this.shownlist[e]=!this.shownlist[e],this.shownlist[e]?(Q("."+e+" .toggle").style.backgroundColor=Q(".chart-legend-row."+e).style.color,this.chart.setVisibility(this.chart.getPropertiesForSeries(e).column-1,!0)):(Q("."+e+" .toggle").style.backgroundColor="transparent",this.chart.setVisibility(this.chart.getPropertiesForSeries(e).column-1,!1))},BrewChart.prototype.createChart=function(){var e=this;e.initLegend(),e.shownlist={beerTemp:!0,beerSet:!0,fridgeSet:!0,fridgeTemp:!0,roomTemp:!0,gravity:!0,auxTemp:!0,filtersg:!0};var t=document.createElement("div");t.className="hide",document.body.appendChild(t);var i={labels:BrewChart.Labels,colors:BrewChart.Colors,connectSeparatedPoints:!0,ylabel:"Temperature",y2label:"Gravity",series:{gravity:{axis:"y2",drawPoints:!0,pointSize:2,highlightCircleSize:4},filtersg:{axis:"y2"}},axisLabelFontSize:12,animatedZooms:!0,gridLineColor:"#ccc",gridLineWidth:"0.1px",labelsDiv:t,labelsDivStyles:{display:"none"},displayAnnotations:!0,strokeWidth:1,axes:{y:{valueFormatter:function(t){return e.tempFormat(t)}},y2:{valueFormatter:function(e){return e.toFixed(3)},axisLabelFormatter:function(e){return e.toFixed(3).substring(1)}}},highlightCircleSize:2,highlightSeriesOpts:{strokeWidth:1.5,strokeBorderWidth:1,highlightCircleSize:5},highlightCallback:function(t,i,r,n){e.showLegend(i,n)},unhighlightCallback:function(t){e.hideLegend()}};e.chart=new Dygraph(document.getElementById(e.cid),e.data,i)};var STATES=[{name:"IDLE",text:"Idle"},{name:"STATE_OFF",text:"Off"},{name:"DOOR_OPEN",text:"Door Open",doorOpen:!0},{name:"HEATING",text:"Heating"},{name:"COOLING",text:"Cooling"},{name:"WAITING_TO_COOL",text:"Waiting to Cool",waiting:!0},{name:"WAITING_TO_HEAT",text:"Waiting to Heat",waiting:!0},{name:"WAITING_FOR_PEAK_DETECT",text:"Waiting for Peak",waiting:!0},{name:"COOLING_MIN_TIME",text:"Cooling Min Time",extending:!0},{name:"HEATING_MIN_TIME",text:"Heating Min Time",extending:!0}];BrewChart.Mode={b:"Beer Constant",f:"Fridge Constant",o:"Off",p:"Profile"},BrewChart.Colors=["rgb(240, 100, 100)","rgb(41,170,41)","rgb(89, 184, 255)","rgb(255, 161, 76)","#AAAAAA","#f5e127","rgb(153,0,153)","#000abb"],BrewChart.Labels=["Time","beerSet","beerTemp","fridgeTemp","fridgeSet","roomTemp","auxTemp","gravity","filtersg"],BrewChart.prototype.addMode=function(e){var t=String.fromCharCode(e);this.anno.push({series:"beerTemp",x:1e3*this.ctime,shortText:t.toUpperCase(),text:BrewChart.Mode[t],attachAtBottom:!0})},BrewChart.testData=function(e){if(255!=e[0])return!1;var t=7&e[1];return 5==t&&{sensor:t,f:16&e[1]}},BrewChart.prototype.addResume=function(e){this.ctime+=60*e,this.anno.push({series:"beerTemp",x:1e3*this.ctime,shortText:"R",text:"Resume",attachAtBottom:!0})},BrewChart.prototype.process=function(e){var t=!1,i=this;i.filterSg=null;for(var r=0;r<e.length;){var n=e[r++],a=e[r++];if(255==n){if(5!=(15&a))return void alert("log version mismatched!");i.celius=!(16&a);var o=e[r++];o=256*o+e[r++],i.interval=o,i.starttime=(e[r]<<24)+(e[r+1]<<16)+(e[r+2]<<8)+e[r+3],i.ctime=i.starttime,r+=4,i.data=[],i.anno=[],i.state=[],i.cstate=0,this.clearData(),t=!0,GravityTracker.init()}else if(244==n)i.addMode(a);else if(241==n)i.cstate=a;else if(254==n){if(i.lidx){var s;for(s=i.lidx;s<i.numLine;s++)i.dataset.push(NaN);i.data.push(i.dataset)}i.lidx=0,i.addResume(a)}else if(248==n){var l=256*(127&e[r++])+e[r++];i.og=l/1e4}else if(240==n){i.changes=a,i.lidx=0;var d=new Date(1e3*this.ctime);i.incTime(),i.dataset=[d],i.processRecord()}else if(n<128){var c=256*n+a;i.lidx==i.numLine-1?(c=32767==c?NaN:c>8e3?c/1e4:c/1e3,i.sg=c,isNaN(c)||(i.filterSg=GravityFilter.add(c),GravityTracker.add(i.filterSg,i.ctime))):(c=32767==c?NaN:c/100)>=225&&(c=225-c),i.lidx<i.numLine?void 0!==i.dataset?(i.dataset.push(c),i.laststat[i.lidx]=i.lidx>=i.numLine-2?null:c,i.lidx++,i.processRecord()):console.log("Error: missing tag."):console.log("Error: data overlap?")}}return void 0===i.chart?i.createChart():i.chart.updateOptions({file:i.data}),i.chart.setAnnotations(i.anno),t},BrewChart.prototype.processRecord=function(){for(var e=this;0==(1<<e.lidx&e.changes)&&e.lidx<e.numLine;)e.dataset.push(e.laststat[e.lidx]),e.lidx++;e.lidx>=e.numLine&&(isNaN(e.sg)?e.dataset.push(null):e.dataset.push(e.filterSg),e.data.push(e.dataset),e.state.push(e.cstate))};var profileEditor={dirty:!1,tempUnit:"C",C_startday_Id:"startdate",C_savebtn_Id:"savebtn",markdirty:function(e){this.dirty=e,document.getElementById(this.C_savebtn_Id).innerHTML=e?"Save*":"Save"},getStartDate:function(){return this.sd},setStartDate:function(e){},startDayChange:function(){var e=new Date(document.getElementById(this.C_startday_Id).value);isNaN(e.getTime())?document.getElementById(this.C_startday_Id).value=formatDate(this.sd):(this.sd=e,this.reorg(),this.markdirty(!0))},startnow:function(){var e=new Date;document.getElementById(this.C_startday_Id).value=formatDate(e),this.sd=e,this.reorg(),this.markdirty(!0)},rowList:function(){return document.getElementById("profile_t").getElementsByTagName("tbody")[0].getElementsByTagName("tr")},sgChange:function(e){!isNaN(e.innerHTML)||e.innerHTML.match(/^[\d]+%$/)||""==e.innerHTML?(e.saved=e.innerHTML,this.markdirty(!0)):e.innerHTML=e.saved},dayChange:function(e){""==e.innerHTML||isNaN(e.innerHTML)?e.innerHTML=e.saved:(this.markdirty(!0),this.reorg(),ControlChart.update(this.chartdata(),this.tempUnit))},tempChange:function(e){""==e.innerHTML||isNaN(e.innerHTML)?e.innerHTML=e.saved:(this.markdirty(!0),ControlChart.update(this.chartdata(),this.tempUnit))},stableChange:function(e){e.innerHTML.match(/^\s*(\d+)@(\d+)\s*$/)?(e.saved=e.innerHTML,this.markdirty(!0)):isNaN(e.innerHTML)?e.innerHTML=e.saved:(e.saved=parseInt(e.innerHTML),this.markdirty(!0))},initrow:function(e,t){var i=this,r=t.c;e.type=r;var n=e.getElementsByClassName("stage-temp")[0];"r"==r?n.innerHTML="":(n.innerHTML=t.t,n.contentEditable=!0,n.onblur=function(){i.tempChange(this)},n.onfocus=function(){this.saved=this.innerHTML});var a=e.getElementsByClassName("stage-time")[0];a.innerHTML=t.d,a.contentEditable=!0,a.onblur=function(){i.dayChange(this)},a.onfocus=function(){this.saved=this.innerHTML};var o=e.getElementsByClassName("stage-stabletime")[0],s=e.getElementsByClassName("stage-sg")[0];"r"==r?(s.innerHTML="",o.innerHTML=""):(s.saved=t.g,s.innerHTML=void 0===t.g?"":t.g,s.contentEditable=!0,s.onblur=function(){i.sgChange(this)},s.onfocus=function(){this.saved=this.innerHTML},void 0===t.s?o.innerHTML="":o.innerHTML=void 0===t.x?t.s:t.x+"@"+t.s,o.contentEditable=!0,o.onblur=function(){i.stableChange(this)},o.onfocus=function(){this.saved=this.innerHTML});var l=e.getElementsByClassName("for-time")[0],d=e.getElementsByClassName("condition")[0],c={t:0,g:1,a:3,s:2,o:4,u:5,v:6,b:7,x:8,w:9,e:10};"r"==r?(l.style.display="block",d.style.display="none"):(d.value=t.c,d.selectedIndex=c[t.c],l.style.display="none",d.style.display="block")},datestr:function(e){return formatDate(new Date(this.sd.getTime()+1e3*Math.round(86400*e)))},reorg:function(){for(var e=this.rowList(),t=this.sd.getTime(),i=0;i<e.length;i++){var r=e[i];r.className=i%2?"odd":"even",r.getElementsByClassName("diaplay-time")[0].innerHTML=formatDate(new Date(t));var n=this.rowTime(r);t+=1e3*Math.round(86400*n)}},chartdata:function(){var e=this.rowList();if(0==e.length)return[];var t=this.sd.getTime(),i=e[0],r=this.rowTemp(i),n=[];n.push([new Date(t),r]);for(var a=0;a<e.length;a++){var o;o="r"==(i=e[a]).type?this.rowTemp(e[a+1]):this.rowTemp(i),t+=1e3*Math.round(86400*this.rowTime(i)),n.push([new Date(t),o])}return n},addRow:function(){var e=document.getElementById("profile_t").getElementsByTagName("tbody")[0],t=e.getElementsByTagName("tr");if(t.length>=13)alert("Too many steps!");else{var i;if(0==t.length)i={c:"t",t:"C"==this.tempUnit?20:68,d:1,g:1.01};else{var r=t[t.length-1],n=this.row.cloneNode(!0);this.initrow(n,{c:"r",d:1}),e.appendChild(n),i={c:"t",t:this.rowTemp(r),d:1,g:""}}n=this.row.cloneNode(!0);this.initrow(n,i),e.appendChild(n),this.reorg(),this.markdirty(!0),ControlChart.update(this.chartdata(),this.tempUnit)}},delRow:function(){var e=this.rowList();if(0!=e.length){var t=e[e.length-1];if(e.length>1){var i=e[e.length-2];i.parentNode.removeChild(i)}t.parentNode.removeChild(t),this.markdirty(!0),ControlChart.update(this.chartdata(),this.tempUnit)}},rowTemp:function(e){return parseFloat(e.getElementsByClassName("stage-temp")[0].innerHTML)},rowCondition:function(e){return e.getElementsByClassName("condition")[0].value},rowTime:function(e){return parseFloat(e.getElementsByClassName("stage-time")[0].innerHTML)},rowSg:function(e){return e.getElementsByClassName("stage-sg")[0].saved},rowSt:function(e){var t=e.getElementsByClassName("stage-stabletime")[0].innerHTML;if("string"!=typeof t)return t;var i=t.match(/^\s*(\d+)@(\d+)\s*$/);return i?parseInt(i[2]):parseInt(t)},rowStsg:function(e){var t=e.getElementsByClassName("stage-stabletime")[0].innerHTML;if("string"!=typeof t)return!1;var i=t.match(/^\s*(\d+)@(\d+)\s*$/);return!!i&&parseInt(i[1])},renderRows:function(e){for(var t=document.getElementById("profile_t").getElementsByTagName("tbody")[0],i=0;i<e.length;i++){var r=this.row.cloneNode(!0);this.initrow(r,e[i]),t.appendChild(r)}this.reorg()},initable:function(e,t){this.sd=t,document.getElementById(this.C_startday_Id).value=formatDate(t);var i=document.getElementById("profile_t").getElementsByTagName("tbody")[0];this.row=i.getElementsByTagName("tr")[0],i.removeChild(this.row),this.renderRows(e)},clear:function(){for(var e=this.rowList(),t=(e.length,e.length-1);t>=0;t--){var i=e[t];i.parentNode.removeChild(i)}this.markdirty(!0)},getProfile:function(){for(var e=this.rowList(),t=[],i=0;i<e.length;i++){var r=e[i],n=this.rowTime(r);if(isNaN(n))return!1;if("r"==r.type)t.push({c:"r",d:n});else{var a=this.rowTemp(r);if(isNaN(a))return!1;if(a>BrewPiSetting.maxDegree||a<BrewPiSetting.minDegree)return!1;var o=this.rowCondition(r),s={c:o,d:n,t:a},l=this.rowSg(r);if("gaobxwe".indexOf(o)>=0){if(""==l)return!1;s.g=l}var d=this.rowSt(r);if("suvbxwe".indexOf(o)>=0){if(isNaN(d))return!1;s.s=d;var c=this.rowStsg(r);c&&(s.x=c)}t.push(s)}}return{s:this.sd.toISOString(),v:2,u:this.tempUnit,t:t}},loadProfile:function(e){this.sd=new Date(e.s),this.tempUnit=e.u,this.clear(),this.renderRows(e.t),ControlChart.update(this.chartdata(),this.tempUnit)},initProfile:function(e){if(void 0!==e){var t=new Date(e.s);this.tempUnit=e.u,profileEditor.initable(e.t,t)}else profileEditor.initable([],new Date)},setTempUnit:function(e){if(e!=this.tempUnit){this.tempUnit=e;for(var t=this.rowList(),i=0;i<t.length;i++){var r=t[i].querySelector("td.ptemp"),n=parseFloat(r.innerHTML);r.innerHTML="C"==e?F2C(n):C2F(n)}}}},PL={pl_path:"P",url_list:"/list",url_save:"/fputs",url_del:"/rm",url_load:"pl.php?ld=",div:"#profile-list-pane",shown:!1,initialized:!1,plist:[],path:function(e){return"/"+this.pl_path+"/"+e},depath:function(e){return e.substring(this.pl_path.length+1)},rm:function(e){var t=this,i="path="+t.path(t.plist[e]);s_ajax({url:t.url_del,m:"DELETE",data:i,success:function(i){t.plist.splice(e,1),t.list(t.plist)},fail:function(e){alert("failed:"+e)}})},load:function(e){var t=this;s_ajax({url:t.path(t.plist[e]),m:"GET",success:function(e){var t=JSON.parse(e);profileEditor.loadProfile(t)},fail:function(e){}})},list:function(e){for(var t,i=this,r=Q(i.div).querySelector("tbody");t=r.querySelector("tr:nth-of-type(1)");)r.removeChild(t);var n=i.row;e.forEach(function(e,t){var a=n.cloneNode(!0);a.querySelector(".profile-name").innerHTML=e,a.querySelector(".profile-name").onclick=function(e){return e.preventDefault(),i.load(t),!1},a.querySelector(".rmbutton").onclick=function(){i.rm(t)},r.appendChild(a)})},append:function(e){this.initialized&&(this.plist.push(e),this.list(this.plist))},init:function(){var e=this;e.initialized=!0,e.row=Q(e.div).querySelector("tr:nth-of-type(1)"),e.row.parentNode.removeChild(e.row),s_ajax({url:e.url_list,m:"POST",data:"dir="+e.path(""),success:function(t){e.plist=[],JSON.parse(t).forEach(function(t){"file"==t.type&&e.plist.push(e.depath(t.name))}),e.list(e.plist)},fail:function(e){alert("failed:"+e)}})},toggle:function(){this.initialized||this.init(),this.shown=!this.shown,this.shown?Q(this.div).style.left="0px":Q(this.div).style.left="-300px"},saveas:function(){Q("#dlg_saveas").style.display="block"},cancelSave:function(){Q("#dlg_saveas").style.display="none"},doSave:function(){var e=Q("#dlg_saveas input").value;if(""!=e&&!e.match(/[\W]/g)){var t=profileEditor.getProfile();if(!1!==t){var i=this,r="path="+i.path(e)+"&content="+encodeURIComponent(JSON.stringify(t));s_ajax({url:(i=this).url_save,m:"POST",data:r,success:function(t){i.append(e),i.cancelSave()},fail:function(e){alert("failed:"+e)}})}else alert("invalid value. check again")}}},BrewPiSetting={valid:!1,maxDegree:30,minDegree:0,tempUnit:"C"},ControlChart={unit:"C",init:function(e,t,i){var r=this;r.data=t,r.unit=i;r.chart=new Dygraph(document.getElementById(e),r.data,{colors:["rgb(89, 184, 255)"],axisLabelFontSize:12,gridLineColor:"#ccc",gridLineWidth:"0.1px",labels:["Time","Temperature"],labelsDiv:document.getElementById(e+"-label"),legend:"always",labelsDivStyles:{textAlign:"right"},strokeWidth:1,axes:{y:{valueFormatter:function(e){return e.toFixed(1)+"&deg;"+r.unit},pixelsPerLabel:20,axisLabelWidth:35},x:{axisLabelFormatter:function(e){d=new Date(e);var t=d.getYear()+1900,i=new RegExp("[^d]?"+t+"[^d]?");return d.toLocaleDateString().replace(i,"")},valueFormatter:function(e){return d=new Date(e),formatDate(d)},pixelsPerLabel:30,axisLabelWidth:40}},highlightCircleSize:2,highlightSeriesOpts:{strokeWidth:1.5,strokeBorderWidth:1,highlightCircleSize:5}})},update:function(e,t){0!=e.length&&(this.data=e,this.unit=t,this.chart.updateOptions({file:this.data}))}},modekeeper={initiated:!1,modes:["profile","beer","fridge","off"],cmode:0,dselect:function(e){var t=document.getElementById(e+"-m"),i=document.getElementById(e+"-m").className.replace(/\snav-selected/,"");t.className=i,document.getElementById(e+"-s").style.display="none"},select:function(e){document.getElementById(e+"-m").className+=" nav-selected",document.getElementById(e+"-s").style.display="block"},init:function(){var e=this;if(!e.initiated){e.initiated=!0;for(var t=0;t<4;t++){var i=e.modes[t];document.getElementById(i+"-s").style.display="none",document.getElementById(i+"-m").onclick=function(){var t=this.id.replace(/-m/,"");e.dselect(e.cmode),e.select(t),e.cmode=t}}e.cmode="profile",e.select(e.cmode)}},apply:function(){if(BrewPiSetting.valid||alert("Not connected to controller."),"beer"==this.cmode||"fridge"==this.cmode){var e=document.getElementById(this.cmode+"-t").value;if(""==e||isNaN(e)||e>BrewPiSetting.maxDegree||e<BrewPiSetting.minDegree)return void alert("Invalid Temperature:"+e);"beer"==this.cmode?BWF.send("j{mode:b, beerSet:"+e+"}"):(console.log("j{mode:f, fridgeSet:"+e+"}"),BWF.send("j{mode:f, fridgeSet:"+e+"}"))}else if("off"==this.cmode)BWF.send("j{mode:o}");else{if(profileEditor.dirty)return void alert("save the profile first before apply");document.getElementById("dlg_beerprofilereminder").style.display="block",document.getElementById("dlg_beerprofilereminder").querySelector("button.ok").onclick=function(){document.getElementById("dlg_beerprofilereminder").style.display="none";var e=parseFloat(Q("#dlg_beerprofilereminder input").value);updateOriginGravity(e);var t={name:"webjs",og:1,gravity:e};s_ajax({url:"gravity",m:"POST",mime:"application/json",data:JSON.stringify(t),success:function(e){BWF.send("j{mode:p}")},fail:function(e){alert("failed:"+e)}})},document.getElementById("dlg_beerprofilereminder").querySelector("button.oknog").onclick=function(){document.getElementById("dlg_beerprofilereminder").style.display="none",BWF.send("j{mode:p}")},document.getElementById("dlg_beerprofilereminder").querySelector("button.cancel").onclick=function(){document.getElementById("dlg_beerprofilereminder").style.display="none"}}}},BChart={offset:0,url:"chart.php",toggle:function(e){this.chart.toggleLine(e)},reqdata:function(){var e=this,t="offset="+e.offset;void 0!==e.startOff&&null!==e.startOff&&(t=t+"&index="+e.startOff);var i=new XMLHttpRequest;i.open("GET",e.url+"?"+t),i.timeout=5e3,i.ontimeout=function(e){console.error("Timeout!!")},i.responseType="arraybuffer",i.onload=function(t){if(404!=this.status){var r=new Uint8Array(this.response);if(0==r.length)return e.timer&&clearInterval(e.timer),e.timer=null,void setTimeout(function(){e.reqdata()},3e3);e.chart.process(r)?(e.offset=r.length,e.startOff=i.getResponseHeader("LogOffset"),getLogName()):e.offset+=r.length,isNaN(e.chart.og)||(updateOriginGravity(e.chart.og),e.chart.og=NaN),e.chart.sg&&!isNaN(e.chart.sg)&&(updateGravity(e.chart.sg),e.chart.sg=NaN,checkfgstate()),null==e.timer&&e.settimer()}else console.log("Error getting log data")},i.onerror=function(){console.log("error getting data."),setTimeout(function(){e.reqdata()},1e4)},i.send()},settimer:function(){var e=this;e.timer=setInterval(function(){e.reqdata()},1e3*e.chart.interval)},init:function(e){this.chart=new BrewChart(e)},timer:null,start:function(){this.running||(this.running=!0,this.offset=0,this.reqdata())},reqnow:function(){var e=this;e.timer&&clearInterval(e.timer),e.timer=null,e.reqdata()}},BrewMath={abv:function(e,t){return(76.08*(e-t)/(1.775-e)*(t/.794)).toFixed(1)},att:function(e,t){return Math.round((e-t)/(e-1)*100)},sg2pla:function(e){return 1111.14*e-616.868-630.272*e*e+135.997*e*e*e},pla2sg:function(e){return 1+e/(258.6-e/258.2*227.1)}}</script><style>@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\000033}}.lcddisplay{width:280px;height:90px;float:left;margin:5px;background:#000;background:-moz-linear-gradient(top,#000 2%,#2b2b2b 11%,#212121 54%,#212121 92%,#000 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(2%,#000),color-stop(11%,#2b2b2b),color-stop(54%,#212121),color-stop(92%,#212121),color-stop(100%,#000));background:-webkit-linear-gradient(top,#000 2%,#2b2b2b 11%,#212121 54%,#212121 92%,#000 100%);background:-o-linear-gradient(top,#000 2%,#2b2b2b 11%,#212121 54%,#212121 92%,#000 100%);background:-ms-linear-gradient(top,#000 2%,#2b2b2b 11%,#212121 54%,#212121 92%,#000 100%);background:linear-gradient(top,#000 2%,#2b2b2b 11%,#212121 54%,#212121 92%,#000 100%);-webkit-box-shadow:inset 1px 1px 5px #333;-moz-box-shadow:inset 1px 1px 5px #333;box-shadow:inset 1px 1px 5px #333;border:2px solid #333;-webkit-border-radius:2px;-moz-border-radius:2px;border-radius:2px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000325}}.lcddisplay .lcd-text{float:left;margin:5px 16px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000330}}.lcd-line{float:left;clear:left;font-size:16px;font-weight:400;font-style:normal;font-family:"Courier New",Courier,monospace;color:#ff0;white-space:pre}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000341}}.chart-legend-row .toggle{width:8px;height:8px;border-radius:5px;float:left;margin:2px 0 0 0;cursor:pointer;border:1px solid}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000350}}.chart-legend{font-family:Lucida Grande,Lucida Sans,Arial,sans-serif;font-size:11px;margin:10px 0 0 0;border:solid 1px #777;border-radius:5px;float:right;width:155px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000359}}.chart-legend-row{padding:8px 5px 8px 5px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000362}}.legend-label{float:left;padding:0 5px 0 5px;cursor:pointer}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000367}}.legend-value{float:right}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000370}}.chart-legend-row.time{background-color:#def}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000373}}#div_lb{display:none}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000375}}#div_g{float:left;width:800px;height:390px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000380}}#chart-container{width:965px;height:410px;padding:5px 5px 5px 5px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000385}}.hide{display:none}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000387}}.frame{border-radius:5px;margin:5px 5px 5px 5px;border:solid 1px #304d75;width:975px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000394}}#top-frame{height:520px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000395}}#bottom-frame{height:380px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\0000396}}#topbar{width:965px;height:108px;background-color:#5c9ccc;padding:5px 5px 5px 5px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003102}}#menu{float:right}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003106}}#banner{font-size:18pt;float:left;color:#fff;font-family:"Comic Sans MS",cursive,sans-serif;margin-top:20px;margin-left:20px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003114}}#recording{color:#add8e6;font-size:18px;font-family:serif}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003119}}#top-frame button{float:right;width:200px;margin-top:3px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003126}}.navbar{margin:0;padding:.2em .2em 0;border:1px solid #4297d7;background:#5c9ccc;color:#fff;height:4em;display:block;position:relative}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003135}}#set-mode-text{margin-left:2px;float:left;margin:.2em}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003139}}.navitem{background:#dfeffc;font-weight:700;color:#2e6e9e;margin:.2em .2em 0 0;padding:.5em;border-top-right-radius:5px;border-top-left-radius:5px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003148}}.nav-selected{background:#fff;font-weight:700;color:#e17009;margin:.2em .2em 0 0;padding:.5em .5em .6em .5em}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003155}}.navitems{display:block;margin-top:2em}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003159}}#apply{background:#dfeffc;font-weight:700;color:#2e6e9e;margin:.2em .1em 0 0;padding:.5em}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003166}}#containter{margin:.5em;width:965px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003169}}.profileTable td,th{padding:3px;text-align:center}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003171}}.profileTable tbody TR.odd{background:#f7f7f7}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003174}}.profileTable tbody TR.even{width:100%}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003176}}.profileTable TH{border:1px solid #4297d7;background:#5c9ccc;color:#fff;font-weight:700}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003182}}table.profileTable{width:100%}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003184}}#bottom-frame button{color:#1d5987;background:#dfeffc;font-weight:700;border-radius:6px;margin:4px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003191}}#addbutton{float:right;width:120px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003194}}#header{width:968px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003195}}#clearbtn{width:18%}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003196}}#savebtn{width:25%;float:right}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003197}}#delbtn{width:18%}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003199}}.modal{display:none;position:fixed;z-index:100;padding-top:100px;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#000;background-color:rgba(0,0,0,.4)}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003215}}.modal-content{background-color:#fefefe;margin:auto;padding:10px;border:1px solid #888;width:340px;height:220px;border-radius:8px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003226}}#dlg_addgravity button{float:right;width:56px;margin-top:2px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003231}}.dialog-buttons{float:center}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003235}}#modekeeper-apply{margin-top:0}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003236}}#profile-edit{float:left;margin:6px;width:510px;position:relative}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003237}}#tc_chart{width:430px;height:280px;float:right;margin:6px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003239}}#gravity-pane table,#iSpindel-pane table{width:100px;float:right;border:1px solid #fff;border-radius:5px;margin-right:10px;color:#0ff;font-size:12px}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003248}}#iSpindel-pane{display:none}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003250}}#profile-list-pane{position:absolute;background-color:#fafaf0;border-style:outset;border:solid 3px;height:100%;width:200px;overflow:auto;left:-300px;top:0;overflow:auto}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003263}}#profile-list-pane td{white-space:nowrap;overflow:hidden}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003267}}#profile-list-pane .rmbutton{color:red}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003270}}#profile-list-pane a,#profile-list-pane u{text-decoration:none}@media -sass-debug-info{filename{font-family:file\:\/\/\/home\/tom\/Dokumente\/Projekte\/Brauen\/BrewPiLess\/htmljs\/style\.scss}line{font-family:\00003273}}#fgstate{width:10px;height:10px;border-radius:6px;float:right;margin:4px 0 0 0;border:0}</style></head><body onload=init()><div class=frame id=top-frame><div id=topbar><div id=lcd class=lcddisplay><span class=lcd-text><span class=lcd-line id=lcd-line-0>Live LCD waiting</span> <span class=lcd-line id=lcd-line-1>for update from</span> <span class=lcd-line id=lcd-line-2>script...</span> <span class=lcd-line id=lcd-line-3></span><p></p><p></p></span></div><div id=banner>BrewPiLess v2.1<div id=recording></div></div><div id=menu><button onclick='window.open("/log")'>Data Logging</button><br><button onclick='window.open("/setup.htm")'>Device Setup</button><br><button onclick='window.open("/config")'>System Config</button><br><button onclick='window.open("/gdc")'>Gravity Sensor</button></div><div id=gravity-pane><table><tr><th>OG:</th><td><span id=gravity-og onclick=inputOG()>--</span></td><td></td></tr><tr><th>SG:</th><td><span id=gravity-sg onclick=inputSG()>--</span><div id=fgstate></div></td><td></td></tr><tr><th>ATT:</th><td><span id=gravity-att>--</span>%</td><td></td></tr><tr><th>ABV:</th><td><span id=gravity-abv>--</span>%</td><td></td></tr></table></div><div id=iSpindel-pane><table><tr><th colspan=2><span id=iSpindel-name></span></th></tr><tr><th>Battery</th><td><span id=iSpindel-battery>--</span></td><td></td></tr><tr><th colspan=2>Last Update</th></tr><tr><td colspan=2 align=center><span id=iSpindel-last>--</span></td><td></td></tr></table></div></div><div id=chart-container><div id=div_g></div><div id=chart-legend class=chart-legend><div class="chart-legend-row time"><div class=beer-chart-legend-time>Date/Time</div></div><div class="chart-legend-row beerTemp"><div class="toggle beerTemp" onclick='BChart.toggle("beerTemp")'></div><div class=legend-label onclick='BChart.toggle("beerTemp")'>Beer Temp</div><div class=legend-value>--</div><br></div><div class="chart-legend-row beerSet"><div class="toggle beerSet" onclick='BChart.toggle("beerSet")'></div><div class=legend-label onclick='BChart.toggle("beerSet")'>Beer Set</div><div class=legend-value>--</div><br></div><div class="chart-legend-row fridgeTemp"><div class="toggle beerSet" onclick='BChart.toggle("fridgeTemp")'></div><div class=legend-label onclick='BChart.toggle("fridgeTemp")'>Fridge Temp</div><div class=legend-value>--</div><br></div><div class="chart-legend-row fridgeSet"><div class="toggle beerSet" onclick='BChart.toggle("fridgeSet")'></div><div class=legend-label onclick='BChart.toggle("fridgeSet")'>Fridge Set</div><div class=legend-value>--</div><br></div><div class="chart-legend-row roomTemp"><div class="toggle beerSet" onclick='BChart.toggle("roomTemp")'></div><div class=legend-label onclick='BChart.toggle("roomTemp")'>Room Temp</div><div class=legend-value>--</div><br></div><div class="chart-legend-row auxTemp"><div class="toggle gravity" onclick='BChart.toggle("auxTemp")'></div><div class=legend-label onclick='BChart.toggle("auxTemp")'>Aux Temp</div><div class=legend-value>--</div><br></div><div class="chart-legend-row gravity"><div class="toggle gravity" onclick='BChart.toggle("gravity")'></div><div class=legend-label onclick='BChart.toggle("gravity")'>Gravity</div><div class=legend-value>--</div><br></div><div class="chart-legend-row filtersg"><div class="toggle gravity" onclick='BChart.toggle("filtersg")'></div><div class=legend-label onclick='BChart.toggle("filtersg")'>FilteredSG</div><div class=legend-value>--</div><br></div><div class="chart-legend-row state"><div class=legend-label>state</div><br></div></div></div></div><div class=frame id=bottom-frame><div class=navbar id=header><div id=set-mode-text>Set temperature mode:</div><div class=navitems><span class=navitem id=profile-m>Beer profile</span> <span class=navitem id=beer-m>Beer Const.</span> <span class=navitem id=fridge-m>Fridge Const.</span> <span class=navitem id=off-m>Off</span> <button id=modekeeper-apply onclick=modekeeper.apply()>Apply</button></div></div><div id=containter><div id=profile-s class=detail><div id=profile-edit><div id=profile-list-pane><table><tr><td><button class=rmbutton>X</button><a href=# class=profile-name></a></td></tr></table></div><div><div><span>Start Date:</span><input size=16 id=startdate onchange=profileEditor.startDayChange()> <button id=setnow onclick=profileEditor.startnow()>Now</button> <button id=addbutton onclick=profileEditor.addRow()>Add</button></div></div><table class=profileTable id=profile_t><thead><tr><th>T(&deg;<span class=t_unit>C</span>)</th><th>Condition</th><th>Days</th><th>SG</th><th>Stable</th><th>Start Time</th></tr></thead><tbody><tr><td class=stage-temp>19</td><td><div class=for-time>Ramp</div><div class=condition-con><select class=condition><option value=t>Time</option><option value=g>SG</option><option value=s>Stable</option><option value=a>Time & SG</option><option value=o>Time OR SG</option><option value=u>Time OR Stable</option><option value=v>Time & Stable</option><option value=b>SG OR Stable</option><option value=x>SG & Stable</option><option value=w>ALL</option><option value=e>Either</option></select></div></td><td class=stage-time>7</td><td class=stage-sg>1.01</td><td class=stage-stabletime></td><td class=diaplay-time></td></tr></tbody></table><div><button id=delbtn onclick=profileEditor.delRow()>Delete</button> <button id=clearbtn onclick=profileEditor.clear()>Clear</button> <button id=loadbtn onclick=PL.toggle()>...</button> <button id=saveasbtn onclick=PL.saveas()>Save As</button> <button id=savebtn onclick=saveprofile()>Save</button></div></div><div id=tc_chart></div></div><div id=beer-s class=detail>Set Beer temp: <input size=6 id=beer-t>&deg;<span class=t_unit>C</span></div><div id=fridge-s class=detail>Set Fridge temp: <input size=6 id=fridge-t>&deg;<span class=t_unit>C</span></div><div id=off-s class=detail>Turning temperature controll Off.</div></div><div id=dlg_beerprofilereminder class=modal><div class=modal-content><p><span class=msg></span>Note: For Beer Profoile to work properly,<ol><li>Original Gravity Must be specified if SG is specified as percentage(%)</li><li>Local data log must be activated if stability of gravity reading is used.</li></ol>Original Gravity:<input size=6 value=1.0></p><div class=dialog-buttons><button class=oknog>OK, OG already set</button> <button class=ok>OK, Set OG</button> <button class=cancel>Cancel</button></div></div></div><div id=dlg_loading class=modal><div class=modal-content><p>Communicating with BrewPiLess controller..</p></div></div><div id=dlg_addgravity class=modal><div class=modal-content><p><span class=msg></span><input size=6 value=1.0></p><div class=dialog-buttons><button onclick=dismissgravity()>Cancel</button> <button onclick=inputgravity()>OK</button></div></div></div><div id=dlg_saveas class=modal><div class=modal-content><span class=msg>Save Profile As</span><br><input size=32><br>*No special letters and space allowed. <button onclick=PL.cancelSave()>Cancel</button> <button onclick=PL.doSave()>OK</button></div></div></div></body></html>